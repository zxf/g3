/*!
* g3 v0.0.1
* Copyright 2013 Felix.Zhu
*/
var g3=function(){var a={};MODULESPARATOR=".";var b={};a.module=function(){if(1==arguments.length){if("string"==typeof arguments[0]){var c=[];arguments[0]&&(c=arguments[0].split(MODULESPARATOR));for(var d=b,e=0;e<c.length;e++){if(!(c[e]in d)){d=void 0;break}d=d[c[e]]}return d}for(var f in arguments[0]){var g=f.split(MODULESPARATOR),h=g.pop(),i=a.module(g.join(MODULESPARATOR));i[h]=arguments[0][f]}return b}if("string"==typeof arguments[0]){var d=a.module(arguments[0]);if(void 0!==d)for(var f in arguments[1])d[f]=arguments[1][f];else{var j={};j[arguments[0]]=arguments[1],a.module(j),d=arguments[1]}return d}return void 0},a.Object=function(){},a.Object.prototype={init:function(){}},a.extendClass=function(){var b=a.Object,c={};"string"==typeof arguments[0]?(b=a.module(arguments[0]),c=arguments[1]):"function"==typeof arguments[0]?(b=arguments[0],c=arguments[1]):c=arguments[0];var d=function(){this.parent=e.prototype,this.init.apply(this,arguments)},e=function(){};e.prototype=b.prototype,d.prototype=new e;for(var f in c)d.prototype[f]=c[f];return d};var c={};return a.exports=function(a){for(var b in a)c[b]=a[b]},function(){var b={each:function(a,b){for(var c in a)if(b(a[c],c)===!1)break},map:function(a,b){var c;c=a instanceof Array?[]:{};for(var d in a)c[d]=b(a[d],d);return c}};a.module("utils",b)}(),function(){var b=a.extendClass({init:function(){}});a.module("backends",{base:b})}(),function(){var b=a.module("utils"),c=a.extendClass("backends.base",{init:function(a,b){if(!window.THREE)throw"require three.js.";this.camera=new THREE.PerspectiveCamera(75,a/b,1,1100),this.scene=new THREE.Scene,this.renderer=new THREE.CanvasRenderer,this.renderer.setSize(a,b),this.texture_placeholder=document.createElement("canvas"),this.texture_placeholder.width=128,this.texture_placeholder.height=128},addCubeScene:function(a){var c=this;a=b.map(a,function(a){return c.loadTexture(a)}),mesh=new THREE.Mesh(new THREE.CubeGeometry(300,300,300,7,7,7),new THREE.MeshFaceMaterial(a)),mesh.scale.x=-1,this.scene.add(mesh)},loadTexture:function(a){var b=this,c=new THREE.Texture(this.texture_placeholder),d=new THREE.MeshBasicMaterial({map:c,overdraw:!0}),e=new Image;return e.onload=function(){c.needsUpdate=!0,d.map.image=this,b.render()},e.src=a,d},lookAt:function(a){a=new THREE.Vector3(a.x,a.y,a.z),this.camera.lookAt(a)},render:function(){this.renderer.render(this.scene,this.camera)},dom:function(){return this.renderer.domElement}});a.module("backends",{three:c})}(),function(){var b=a.extendClass({init:function(b,c,d){this.container=b,this.backend=new(a.module("backends.three"))(c,d),this.scenes={},this.bindEvents()},bindEvents:function(){var a=this;this.container.appendChild(this.dom());var b=!1,c=90,d=0,e=0,f=0,g=function(){d=Math.max(-85,Math.min(85,d)),e=THREE.Math.degToRad(90-d),f=THREE.Math.degToRad(c),a.target.x=500*Math.sin(e)*Math.cos(f),a.target.y=500*Math.cos(e),a.target.z=500*Math.sin(e)*Math.sin(f),a.backend.lookAt(a.target),a.backend.render()},h=function(a){a.preventDefault(),b=!0,onPointerDownPointerX=a.clientX,onPointerDownPointerY=a.clientY,onPointerDownLon=c,onPointerDownLat=d},i=function(a){b&&(c=.1*(onPointerDownPointerX-a.clientX)+onPointerDownLon,d=.1*(a.clientY-onPointerDownPointerY)+onPointerDownLat,g())},j=function(){b=!1,g()},k=function(a){1==a.touches.length&&(a.preventDefault(),onPointerDownPointerX=a.touches[0].pageX,onPointerDownPointerY=a.touches[0].pageY,onPointerDownLon=c,onPointerDownLat=d)},l=function(a){1==a.touches.length&&(a.preventDefault(),c=.1*(onPointerDownPointerX-a.touches[0].pageX)+onPointerDownLon,d=.1*(a.touches[0].pageY-onPointerDownPointerY)+onPointerDownLat,g())};this.container.addEventListener("mousedown",h,!1),this.container.addEventListener("mousemove",i,!1),this.container.addEventListener("mouseup",j,!1),this.container.addEventListener("touchstart",k,!1),this.container.addEventListener("touchmove",l,!1)},addScene:function(a,b,c){c=c||{x:0,y:0,z:0},this.scenes[a]={materials:b,target:c}},setScene:function(a){this.backend.addCubeScene(this.scenes[a].materials),this.backend.lookAt(this.scenes[a].target),this.target=this.scenes[a].target,this.backend.render()},dom:function(){return this.backend.dom()}});a.module("panorama",{Panorama:b}),a.exports({Panorama:b})}(),c}();